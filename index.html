<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minist√©rio Infantil - Escalas e Chamada</title>
    <style>
        /* ESTILOS BASE - MANTIDOS E UNIFICADOS DO C√ìDIGO 1 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            padding-bottom: 30px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            padding: 10px 0;
        }

        h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1em;
            opacity: 0.95;
        }

        /* NOVO: ESTILOS DE ABAS (TABS) */
        .tabs-nav {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 15px;
            padding: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 14px 10px;
            border: none;
            background: transparent;
            color: #764ba2;
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        /* FIM: ESTILOS DE ABAS (TABS) */

        /* ESTILOS DE SE√á√ÉO (ORIGINAIS DOS C√ìDIGOS 1 E 2) */
        .filter-section, .call-section, .results-section, .room-selection-section {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }

        .filter-title, .form-label {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ESTILOS DO C√ìDIGO 1 (ESCALAS) */
        .date-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }

        .date-btn {
            padding: 16px 10px;
            border: 3px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            font-size: 0.95em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
            text-align: center;
            touch-action: manipulation;
        }

        .date-btn:active {
            transform: scale(0.95);
        }

        .date-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .room-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .room-btn {
            padding: 18px 15px;
            border: 3px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 12px;
            touch-action: manipulation;
        }

        .room-btn:active {
            transform: scale(0.98);
        }

        .room-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .room-icon-btn {
            font-size: 1.8em;
        }

        .room-text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
        }

        .room-age {
            font-size: 0.85em;
            opacity: 0.8;
            font-weight: 500;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-reset {
            background: #6c757d;
            color: white;
        }

        .btn-export {
            background: #10b981;
            color: white;
        }

        .results-header {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            line-height: 1.4;
        }

        .schedule-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .schedule-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 18px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }
        
        .schedule-card.santa-ceia-highlight {
            border-left: 5px solid #dc3545;
            background: linear-gradient(135deg, #fcebeb 0%, #f7636f 100%);
        }

        .schedule-card.santa-ceia-highlight .room-name {
            color: #c82333;
        }

        .schedule-card.santa-ceia-highlight .schedule-date {
            background: #dc3545;
            color: white;
        }

        .room-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .room-age-display {
            font-size: 0.85em;
            color: #666;
            font-weight: 500;
        }

        .date-info {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .schedule-date, .lesson-badge {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.95em;
        }

        .lesson-badge {
            background: #10b981;
        }

        .teacher-search {
            width: 100%;
            padding: 12px;
            margin-bottom: 25px; 
            border: 2px solid #ccc;
            border-radius: 12px;
            font-size: 1em;
            transition: border-color 0.2s ease;
        }
        .teacher-search:focus {
            border-color: #667eea;
            outline: none;
        }

        .teachers-label {
            font-weight: 700;
            color: #555;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .teachers-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .teacher-card {
            background: white;
            padding: 12px 15px;
            border-radius: 10px;
            font-weight: 600;
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1em;
            border: 2px solid transparent; 
            transition: all 0.2s ease;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #333;
        }

        /* ESTILOS DO C√ìDIGO 2 (CHAMADA) - UNIFICADOS */
        .room-selection-section {
            padding: 15px; 
            margin-bottom: 20px;
        }

        .room-tabs-call { /* Renomeado para evitar conflito com .room-tabs-nav */
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .room-tab-call { /* Renomeado para evitar conflito com .tab-btn */
            flex: 1 1 45%; 
            min-width: 120px;
            padding: 15px 10px;
            border: 3px solid #e0e0e0; /* Ajustado para 3px para combinar com o .room-btn do c√≥digo 1 */
            background: white; /* Ajustado para white para combinar com o .room-btn do c√≥digo 1 */
            border-radius: 12px; /* Ajustado para 12px para combinar com o .room-btn do c√≥digo 1 */
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            color: #333; /* Ajustado para #333 para combinar com o .room-btn do c√≥digo 1 */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .room-tab-call.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .room-tab-call:active {
            transform: scale(0.98); /* Ajustado para 0.98 para combinar com o .room-btn do c√≥digo 1 */
        }

        .room-name-tab {
            font-size: 1.1em;
        }

        .room-age-tab {
            font-size: 0.8em;
            font-weight: 500;
            opacity: 0.8;
            margin-top: 3px;
        }

        .call-section h2 {
            font-size: 1.2em; /* Corrigido para n√£o conflitar com h1 */
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }

        .btn-submit {
            background: #10b981;
            padding: 16px 20px; /* Ajustado para combinar com os bot√µes do C√≥digo 1 */
            border-radius: 12px; /* Ajustado para combinar com os bot√µes do C√≥digo 1 */
            font-size: 1.05em; /* Ajustado para combinar com os bot√µes do C√≥digo 1 */
            margin-top: 25px;
        }
        
        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        /* Outros ajustes de estilo */
            input[type="date"], #teacherName {
            width: 100%;
            /* Altera√ß√µes Feitas AQUI: */
            padding: 16px; /* Aumenta a altura do campo (preenchimento interno) */
            font-size: 1.1em; /* Aumenta o tamanho do texto dentro do campo */
            /* Outras propriedades de estilo mantidas: */
            border: 2px solid #ccc; 
            border-radius: 12px;
            transition: border-color 0.2s ease;
        }
        
        /* ESTILO PARA A SE√á√ÉO DE ADICIONAR CRIAN√áA */
        .add-kid-section {
            margin-bottom: 20px;
            padding-top: 5px;
        }

        .add-kid-input-group {
            display: flex;
            gap: 10px;
            align-items: stretch;
            margin-bottom: 10px;
        }

        #extraKidName {
            flex: 1;
            padding: 12px;
            border: 2px solid #ccc;
            border-radius: 12px;
            font-size: 1em;
            transition: border-color 0.2s ease;
        }

        #extraKidName:focus {
            border-color: #667eea;
            outline: none;
        }

        .btn-add-kid {
            padding: 0 15px;
            background: #ffc107; /* Amarelo */
            color: #333;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-add-kid:active {
            transform: scale(0.98);
        }


        html {
            scroll-behavior: smooth;
        }
        
        button:focus {
            outline: none;
        }
        
        @media (max-width: 360px) {
            h1 {
                font-size: 1.5em;
            }
            
            .date-buttons {
                grid-template-columns: 1fr;
            }
            
            .add-kid-input-group {
                flex-direction: column;
            }
            .btn-add-kid {
                height: 48px;
            }
        }

        /* CSS PARA OS CARDS DE CRIAN√áAS - ALTERADO SIGNIFICATIVAMENTE AQUI */
        .kids-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); /* Aumenta o tamanho base */
            gap: 15px;
            margin-top: 20px;
        }
        
        .kid-card {
            background: #f8f9fa;
            border: 3px solid #dee2e6;
            border-radius: 15px;
            padding: 0; /* Remove padding para a imagem preencher */
            overflow: hidden; /* Garante que a imagem n√£o vaze */
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Ajustado para acomodar a imagem e o nome */
            height: 180px; /* Altura fixa para todos os cart√µes */
            position: relative;
        }
        
        /* ESTILO PARA CRIAN√áA ADICIONADA MANUALMENTE */
        .kid-card.extra {
            background: #fff8e1; /* Amarelo muito claro */
            border-color: #ffc107; /* Amarelo */
        }
        
        .kid-card:active {
            transform: scale(0.98);
        }
        
        .kid-card.present {
            background: #e6f7ef; /* Fundo verde claro */
            border-color: #10b981; /* Borda verde */
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .kid-photo {
            width: 100%; /* A imagem cobre a largura total do card */
            height: 140px; /* Altura fixa para a imagem */
            object-fit: cover; /* Garante que a imagem preencha sem distorcer */
            border-radius: 12px 12px 0 0; /* Apenas bordas superiores */
            border-bottom: none; /* Remove a borda de baixo */
            
            /* Remove a borda e sombra extras se for uma imagem real */
            border: none;
            box-shadow: none;
        }
        
        .kid-card.present .kid-photo {
            border-color: #10b981; /* Manter se houver uma borda sutil no card */
        }
        
        /* ESTILO PARA PHOTO PLACEHOLDER DE CRIAN√áA EXTRA */
        .kid-card.extra .kid-photo {
            background: #ffc107;
            border-color: #ffc107; /* Cor da borda do card extra */
            font-size: 2.5em; /* Aumenta o √≠cone ainda mais */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: none;
            border-radius: 12px 12px 0 0; /* Bordas superiores */
        }
        
        .kid-card.extra.present .kid-photo {
            background: #10b981;
            border-color: #10b981;
        }

        .kid-name {
            font-size: 1.1em; /* Nome um pouco maior */
            font-weight: 600;
            color: #333;
            line-height: 1.2;
            padding: 8px 5px; /* Adiciona padding para o nome */
            width: 100%; /* Garante que o nome ocupe a largura */
            background: white; /* Fundo branco para o nome */
            border-top: 1px solid #eee; /* Linha sutil separando da imagem */
            border-radius: 0 0 12px 12px; /* Bordas inferiores */
        }

        .kid-card.present .kid-name {
            background: #d4ede6; /* Fundo verde claro para o nome quando presente */
            border-color: #10b981;
        }

        .kid-card.extra .kid-name {
            background: #ffe082; /* Fundo amarelo claro para o nome extra */
        }

        .kid-card.extra.present .kid-name {
            background: #d4ede6; /* Fundo verde claro para o nome extra e presente */
        }

        /* Ajuste para o form-label antes da lista de crian√ßas */
        #kidsList > .form-label {
            margin-bottom: 15px; /* Mais espa√ßo antes da grade de crian√ßas */
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚úùÔ∏è Minist√©rio Infantil ‚úùÔ∏è</h1>
            <p class="subtitle">Escalas e Chamadas - Novembro 2025</p>
        </header>

        <div class="tabs-nav">
            <button class="tab-btn active" data-tab="escalas" onclick="openTab('escalas', this)">Escalas üìÖ</button>
            <button class="tab-btn" data-tab="chamada" onclick="openTab('chamada', this)">Chamada üîî</button>
        </div>
        <div class="tab-content active" id="tab-escalas">
            <div class="filter-section">
                <div class="filter-title">üîé Buscar por Professor</div>
                <input type="text" id="teacherSearchInput" class="teacher-search" placeholder="Digite o nome do professor" oninput="filterByTeacher(this.value)">
                
                <div class="filter-title">üìÖ Escolha a Data</div>
                <div class="date-buttons" id="dateButtons"></div>

                <div class="filter-title">üè† Escolha a Sala</div>
                <div class="room-buttons" id="roomButtons"></div>

                <div class="action-buttons">
                    <button class="btn btn-reset" onclick="resetFilters()">üîÑ Mostrar Todas</button>
                    <button class="btn btn-export" onclick="exportToCSV()">üì• Exportar CSV</button>
                </div>
            </div>

            <div class="results-section">
                <div class="results-header">
                    üìã <span id="resultsTitle">Todas as Escalas</span>
                </div>
                <div class="schedule-grid" id="scheduleGrid"></div>
            </div>
        </div>
        <div class="tab-content" id="tab-chamada">
            <div class="room-selection-section">
                <div class="form-label">üè† Selecione a Sala (Obrigat√≥rio)</div>
                <div class="room-tabs-call" id="roomTabsCall">
                    </div>
            </div>

            <div class="call-section">
                <h2 class="form-label" id="chamadaTitle">üìùChamada - Selecione a Sala Acima üëÜ</h2>

                <div class="form-group">
                    <label for="teacherName" class="form-label">üßë‚Äçüè´ Nome do Professor(a):</label>
                    <input type="text" id="teacherName" placeholder="Nome da Dupla" required>
                </div>

                <div class="form-group">
                    <label for="dateInput" class="form-label">üìÖ Data da Aula:</label>
                    <input type="date" id="dateInput" required>
                </div>
                
                <div class="add-kid-section">
                    <div class="form-label">‚ú® Adicionar Crian√ßa/Visitante</div>
                    <div class="add-kid-input-group">
                        <input type="text" id="extraKidName" placeholder="Nome da crian√ßa visitante" disabled>
                        <button class="btn btn-add-kid" onclick="addExtraKid()" disabled>+ Adicionar</button>
                    </div>
                </div>
                <div id="kidsList">
                    <div class="empty-state">
                        Escolha uma sala para come√ßar a lista de chamada.
                    </div>
                </div>

                <button class="btn btn-submit" onclick="submitCall()">‚úÖ Finalizar Chamada</button>
            </div>
        </div>
        </div>

    <script>
        // *** SEU URL DO APPS SCRIPT DEPLOYED EST√Å AQUI ***
        const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzHuppngUjPnczhnv2r2BOakl617vHkpZwC_xq78Me0cp6TH2tepHTfiUgHKI_Nb0KIJA/exec';
        // ************************************************

        // DADOS COMPARTILHADOS (ESCALAS E CHAMADA)
        const roomsData = {
            ber√ßario: { name: "Ber√ß√°rio", age: "0-2 anos", icon: "üë∂" },
            alfa: { name: "Alfa", age: "3-4 anos", icon: "üß∏" },
            beta: { name: "Beta", age: "5-6 anos", icon: "üé®" },
            gama: { name: "Gama", age: "7-8 anos", icon: "‚öΩ" },
            √¥mega: { name: "√îmega", age: "9-11 anos", icon: "üìö" }
        };

        // NOVO: DADOS FIXOS DAS CRIAN√áAS PARA A CHAMADA VISUAL
        const kidsData = {
            ber√ßario: [
                { id: 1, name: "Maria Eduarda", photo: "m_eduarda.png" },
                { id: 2, name: "Jo√£o Pedro", photo: "j_pedro.png" },
                { id: 3, name: "Sophia R.", photo: "sophia.png" },
                { id: 4, name: "Ben√≠cio L.", photo: "benicio.png" },
                { id: 5, name: "Lara M.", photo: "lara.png" }
            ],
            alfa: [
                { id: 6, name: "Alice", photo: "alice_alfa.png" },
                { id: 7, name: "Levi", photo: "levi_alfa.png" },
                { id: 8, name: "Emily", photo: "emily_alfa.png" },
                { id: 9, name: "Arthur", photo: "arthur_alfa.png" },
                { id: 10, name: "Laura", photo: "laura_alfa.png" },
                { id: 11, name: "Ben√≠cio", photo: "benicio_aalfa.png" },
                { id: 12, name: "Helo√≠sa", photo: "heloisa_alfa.png" },
                { id: 13, name: "J√∫lio", photo: "julio_alfa.png" },
                { id: 14, name: "Bernardo", photo: "bernardo_alfa.png" },
                { id: 15, name: "Isadora", photo: "isadora_alfa.png" },
                { id: 16, name: "Emanuel", photo: "emanuel_alfa.png" },
                { id: 17, name: "Heitor", photo: "heitor_alfa.png" },
                { id: 18, name: "Davi", photo: "davi_alfa.png" }
            ],
            beta: [
                { id: 19, name: "Mait√™", photo: "maite_beta.png" },
                { id: 20, name: "Liz Pacheco", photo: "liz_pacheco_beta.png" },
                { id: 21, name: "Helena M.", photo: "helena_beta.png" },
                { id: 22, name: "Pedro", photo: "pedro_beta.png" },
                { id: 23, name: "Tiffany", photo: "tiffany_beta.png" },
                { id: 24, name: "Arthur Souza", photo: "arthur_beta.png" },
                { id: 25, name: "Jo√£o", photo: "joao_beta.png" },
                { id: 26, name: "Jos√© Lu√≠s", photo: "jose_luis_beta.png" },
                { id: 27, name: "Jo√£o Miguel", photo: "joao_miguel_beta.png" },
                { id: 28, name: "Matteo", photo: "matteo_beta.png" },
                { id: 29, name: "Murilo", photo: "murilo_beta.png" },
                { id: 30, name: "Elisa", photo: "elisa_beta.png" },
                { id: 31, name: "Safira", photo: "safira_beta.png" },
                { id: 32, name: "Manuella", photo: "manuella_beta.png" },
                { id: 33, name: "Nicoly", photo: "nicoly_beta.png" },
                { id: 34, name: "Helena P.", photo: "helena_beta.png" },
                { id: 35, name: "Enrico J.", photo: "enrico_beta.png" },
                { id: 36, name: "Liz Medeiros", photo: "liz_medeiros_beta.png" },
                { id: 37, name: "Arthur R.", photo: "arthur_beta.png" },
                { id: 38, name: "Benjamin", photo: "benjamin_beta.png" }
            ],
            gama: [
                { id: 39, name: "Isaac", photo: "isaac_gama.png" },
                { id: 40, name: "Davi", photo: "davi_gama.png" },
                { id: 41, name: "Sophia", photo: "sophia_gama.png" },
                { id: 42, name: "Wendel", photo: "wendel_gama.png" },
                { id: 43, name: "Isabela", photo: "isabela_gama.png" },
                { id: 44, name: "Lauren", photo: "lauren_gama.png" },
                { id: 45, name: "Brayan", photo: "brayan_gama.png" },
                { id: 46, name: "Elisa", photo: "elisa_gama.png" },
                { id: 47, name: "Emanuelly", photo: "emanuelly_gama.png" },
                { id: 48, name: "Kau√£", photo: "kaua_gama.png" },
                { id: 49, name: "Vicente", photo: "vicente_gama.png" },
                { id: 50, name: "Elisa Rom√£o", photo: "elisa_romao_gama.png" },
                { id: 51, name: "Helena", photo: "helena_gama.png" },
                { id: 52, name: "Ana Clara", photo: "ana_clara_gama.png" },
                { id: 53, name: "√ârick", photo: "erick_gama.png" },
                { id: 54, name: "Lorenzo", photo: "lorenzo_gama.png" },
                { id: 55, name: "Theo", photo: "theo_gama.png" }
            ],
            √¥mega: [
                { id: 56, name: "Nicolly", photo: "nicolly_omega.png" },
                { id: 57, name: "Saulo", photo: "saulo_omega.png" },
                { id: 58, name: "Kemily", photo: "kemily_omega.png" },
                { id: 59, name: "Maria Eduarda", photo: "maria_eduarda_omega.png" },
                { id: 60, name: "Lorena", photo: "lorena_omega.png" },
                { id: 61, name: "Laura", photo: "laura_omega.png" },
                { id: 62, name: "Eduardo", photo: "eduardo_omega.png" },
                { id: 63, name: "Kau√£", photo: "kaua_omega.png" },
                { id: 64, name: "Pedro Lucas", photo: "pedro_lucas_omega.png" },
                { id: 65, name: "Italo", photo: "italo_omega.png" },
                { id: 66, name: "Davi", photo: "davi_omega.png" },
                { id: 67, name: "Laiz", photo: "laiz_omega.png" },
                { id: 68, name: "Micael", photo: "micael_omega.png" },
                { id: 69, name: "Ketelly", photo: "ketelly_omega.png" },
                { id: 70, name: "Bernardo", photo: "bernardo_omega.png" },
                { id: 71, name: "Asafe", photo: "asafe_omega.png" },
                { id: 72, name: "Isabelly", photo: "isabelly_omega.png" },
                { id: 73, name: "Heitor", photo: "heitor_omega.png" },
                { id: 74, name: "L√≠via", photo: "livya_omega.png" },
                { id: 75, name: "Smith", photo: "smith_omega.png" },
                { id: 76, name: "Mikeias", photo: "mikeias_omega.png" },
                { id: 77, name: "Raphaela", photo: "raphaela_omega.png" },
                { id: 78, name: "√âric", photo: "eric_omega.png" },
                { id: 79, name: "Lav√≠nia", photo: "lavinia_omega.png" },
                { id: 80, name: "Pietra", photo: "pietra_omega.png" },
                { id: 81, name: "Sophia", photo: "sophia_omega.png" },
                { id: 82, name: "Jo√£o Miguel", photo: "joao_miguel_omega.png" },
                { id: 83, name: "Maria", photo: "maria_omega.png" }
            ]
        };
        

        // DADOS SOMENTE DA ABA ESCALAS
        const scheduleData = {
            ber√ßario: {
                ...roomsData.ber√ßario,
                schedules: [
                    { date: "02/11/2025", lesson: "13¬∞", teachers: ["Eliane Rodrigues dos Santos", "Wagna da Penha meneguite", "ANA RAFAELA"] },
                    { date: "09/11/2025", lesson: "14¬∞", teachers: ["Juscilene Amaral Pereira", "ERICA", "Luiza Messa Lemos Farias"] },
                    { date: "16/11/2025", lesson: "15¬∞", teachers: ["Leidiane Lopes dos Santos da Silva", "Adriana Lopes dos Santos Martins", "Sarah dos santos Tomaz"] },
                    { date: "23/11/2025", lesson: "16¬∞", teachers: ["MAIARA", "Jussimere Pacheco da Silva", "Kemelly Ribeiro Dos Santos"] },
                    { date: "30/11/2025", lesson: "17¬∞", teachers: ["Eliane Rodrigues dos Santos", "Ingrid Silva Coelho", "DUDA"] }
                ]
            },
            alfa: {
                ...roomsData.alfa,
                schedules: [
                    { date: "02/11/2025", lesson: "13¬∞", teachers: ["Paulo Henrique Mendes Dias", "Iandra Jesus de Novais Santana", "KETTLEY"] },
                    { date: "09/11/2025", lesson: "14¬∞", teachers: ["Roseane Jadyvsky", "ESTER", "Anna Vict√≥ria Bebiano de Carvalho"] },
                    { date: "16/11/2025", lesson: "15¬∞", teachers: ["ROSE PIMENTA", "Stefani Rodrigues Vieira", "RYAN"] },
                    { date: "23/11/2025", lesson: "16¬∞", teachers: ["Marilene Francisca Batista", "Amanda Francisca Batista dos Santos", "KETTLEY"] },
                    { date: "30/11/2025", lesson: "17¬∞", teachers: ["Arthur dos Santos da concei√ß√£o", "Iandra Jesus de Novais Santana", "RYAN"] }
                ]
            },
            beta: {
                ...roomsData.beta,
                schedules: [
                    { date: "02/11/2025", lesson: "13¬∞", teachers: ["N√∫bia Nascimento de Medeiros Dos Santos", "MARCIA", "DOUGLAS"] },
                    { date: "09/11/2025", lesson: "14¬∞", teachers: ["Ana Crysthina Martins Lyrio", "Elaine Pereira Rocha Anacleto ", "SOPHIA"] },
                    { date: "16/11/2025", lesson: "15¬∞", teachers: ["Ana Paula Nogueira Tongo", "Maxsuel Oliveira da Silva", "JEAN"] },
                    { date: "23/11/2025", lesson: "16¬∞", teachers: ["MARCIA", "Mirian Pereira da Cruz da Cunha", "HELOISA"] },
                    { date: "30/11/2025", lesson: "17¬∞", teachers: ["N√∫bia Nascimento de Medeiros Dos Santos", "ANA PAULA", "JEAN"] }
                ]
            },
            gama: {
                ...roomsData.gama,
                schedules: [
                    { date: "02/11/2025", lesson: "13¬∞", teachers: ["Ramon de Oliveira Correa", "Ana Clara Silva Petersen"] },
                    { date: "09/11/2025", lesson: "14¬∞", teachers: ["Lucas de Souza Fernandes", "Libhya da Silva Souza Gon√ßalves Victorino"] },
                    { date: "16/11/2025", lesson: "15¬∞", teachers: ["Alberto Fausther Da Silva De Souza", "Mikaeli Manoel Jacinto Furriel Gon√ßalves"] },
                    { date: "23/11/2025", lesson: "16¬∞", teachers: ["ARTHUR", "Ana Beatriz Rodrigues de Souza", "Alex Gon√ßalves Victorino"] },
                    { date: "30/11/2025", lesson: "17¬∞", teachers: ["Paulo Henrique Mendes Dias", "Libhya da Silva Souza Gon√ßalves Victorino", "Stefani Rodrigues Vieira"] }
                ]
            },
            √¥mega: {
                ...roomsData.√¥mega,
                schedules: [
                    { date: "02/11/2025", lesson: "13¬∞", teachers: ["Kau√£ Guimar√£es Stein", "Brunara dos Santos Alves"] },
                    { date: "09/11/2025", lesson: "14¬∞", teachers: ["Brenda Rodrigues de Souza", "JOICE"] },
                    { date: "16/11/2025", lesson: "15¬∞", teachers: ["Diego Pimenta", "Raiara da Concei√ß√£o Viana Pimenta"] },
                    { date: "23/11/2025", lesson: "16¬∞", teachers: ["Jackson Jadyvysky", "Luiz Felipe Oliveira dos Santos"] },
                    { date: "30/11/2025", lesson: "17¬∞", teachers: ["Kau√£ Guimar√£es Stein", "Brunara dos Santos Alves"] }
                ]
            }
        };
        
        const allDates = ["02/11/2025", "09/11/2025", "16/11/2025", "23/11/2025", "30/11/2025"];

        // VARI√ÅVEIS DE ESTADO DA ABA ESCALAS
        let selectedDate = null;
        let selectedRoom = null;
        let searchTerm = ''; 

        // VARI√ÅVEIS DE ESTADO DA ABA CHAMADA
        let selectedRoomKeyChamada = null;

        /* ---------------------------------- */
        /* FUN√á√ïES GERAIS (ABAS) ¬† ¬† ¬† ¬† ¬† ¬† */
        /* ---------------------------------- */

        function openTab(tabId, element) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById('tab-' + tabId).classList.add('active');
            element.classList.add('active');
            
            // Re-renderiza a lista de chamadas se for a aba "Chamada"
            if (tabId === 'chamada') {
                if (selectedRoomKeyChamada) {
                    // Garante que o bot√£o da sala esteja ativo e a lista renderizada
                    const activeTab = document.querySelector(`.room-tab-call[data-room-key="${selectedRoomKeyChamada}"]`);
                    if (activeTab) {
                        activeTab.classList.add('active');
                    }
                    renderKidsList(selectedRoomKeyChamada); 
                    // Habilita o campo de crian√ßa extra
                    document.getElementById('extraKidName').disabled = false;
                    document.querySelector('.btn-add-kid').disabled = false;

                } else {
                    renderEmptyKidsList();
                     // Desabilita o campo de crian√ßa extra
                    document.getElementById('extraKidName').disabled = true;
                    document.querySelector('.btn-add-kid').disabled = true;
                }
                checkCallFormValidity(); // Valida o estado do bot√£o
            }
        }


        /* ---------------------------------- */
        /* FUN√á√ïES DA ABA ESCALAS ¬† ¬† ¬† ¬† ¬† ¬†*/
        /* ---------------------------------- */
        
        function resetDateAndRoomFilters() {
            selectedDate = null;
            selectedRoom = null;
            document.querySelectorAll('#tab-escalas .date-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('#tab-escalas .room-btn').forEach(b => b.classList.remove('active'));
        }
        
        function filterByTeacher(term) {
            searchTerm = term.toUpperCase().trim();
            
            if (searchTerm.length > 0) {
                resetDateAndRoomFilters(); 
            }
            
            renderSchedules();
        }

        function initializeDateButtons() {
            const container = document.getElementById('dateButtons');
            container.innerHTML = '';
            
            allDates.forEach(date => {
                const btn = document.createElement('button');
                btn.className = 'date-btn';
                btn.textContent = date;
                btn.onclick = () => selectDate(date, btn);
                container.appendChild(btn);
            });
        }

        function initializeRoomButtons() {
            const container = document.getElementById('roomButtons');
            container.innerHTML = '';
            
            Object.keys(scheduleData).forEach(roomKey => {
                const room = scheduleData[roomKey];
                const btn = document.createElement('button');
                btn.className = 'room-btn';
                btn.innerHTML = `
                    <span class="room-icon-btn">${room.icon}</span>
                    <div class="room-text">
                        <div>${room.name}</div>
                        <div class="room-age">${room.age}</div>
                    </div>
                `;
                btn.onclick = () => selectRoomEscalas(roomKey, btn);
                container.appendChild(btn);
            });
        }

        function selectDate(date, btn) {
            document.querySelectorAll('#tab-escalas .date-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('#tab-escalas .room-btn').forEach(b => b.classList.remove('active'));
            selectedRoom = null; 

            if (selectedDate === date) {
                selectedDate = null;
            } else {
                selectedDate = date;
                btn.classList.add('active');
            }
            
            searchTerm = ''; 
            document.getElementById('teacherSearchInput').value = ''; 
            renderSchedules();
        }

        function selectRoomEscalas(roomKey, btn) {
            document.querySelectorAll('#tab-escalas .room-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('#tab-escalas .date-btn').forEach(b => b.classList.remove('active'));
            selectedDate = null; 

            if (selectedRoom === roomKey) {
                selectedRoom = null;
            } else {
                selectedRoom = roomKey;
                btn.classList.add('active');
            }
            
            searchTerm = ''; 
            document.getElementById('teacherSearchInput').value = '';
            renderSchedules();
        }

        function renderSchedules() {
            const container = document.getElementById('scheduleGrid');
            const resultsTitle = document.getElementById('resultsTitle');
            container.innerHTML = '';

            let allSchedules = [];
            Object.keys(scheduleData).forEach(roomKey => {
                const room = scheduleData[roomKey];
                room.schedules.forEach(schedule => {
                    allSchedules.push({ roomKey, room, schedule });
                });
            });

            let filteredSchedules = allSchedules.filter(item => {
                const { roomKey, schedule } = item;
                
                if (searchTerm) {
                    const teachersUpper = schedule.teachers.map(t => t.toUpperCase());
                    return teachersUpper.some(t => t.includes(searchTerm));
                }

                if (selectedDate && schedule.date !== selectedDate) {
                    return false;
                }

                if (selectedRoom && roomKey !== selectedRoom) {
                    return false;
                }

                return true;
            });
            
            let scheduleCount = filteredSchedules.length;

            filteredSchedules.forEach(({ room, schedule }) => {
                const isSantaCeia = schedule.date === '09/11/2025'; 

                const card = document.createElement('div');
                card.className = 'schedule-card' + (isSantaCeia ? ' santa-ceia-highlight' : '');
                
                card.innerHTML = `
                    <div class="schedule-header">
                        <div class="room-name">
                            <span class="room-name-icon">${room.icon}</span>
                            Sala ${room.name}
                        </div>
                        <div class="room-age-display">${room.age}</div>
                        <div class="date-info">
                            <div class="schedule-date">üìÖ ${schedule.date}</div>
                            <div class="lesson-badge">Li√ß√£o ${schedule.lesson}</div>
                        </div>
                    </div>
                    <div class="teachers-section">
                        <div class="teachers-label">üë• Professores:</div>
                        <div class="teachers-list">
                            ${schedule.teachers.filter(t => t && t.trim() !== '').map(teacher => {
                                const isHighlighted = searchTerm && teacher.toUpperCase().includes(searchTerm);
                                return `<div class="teacher-card" ${isHighlighted ? 'style="border: 2px solid #667eea; background: #e6e9f9;"' : ''}>üë®‚Äçüî¨ ${teacher}</div>`;
                            }).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });

            if (scheduleCount === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <h3>Nenhuma escala encontrada</h3>
                        <p>Verifique o nome do professor ou redefina os filtros.</p>
                    </div>
                `;
            }

            let titleText = 'Todas as Escalas';
            if (searchTerm) {
                titleText = `Resultados para "${searchTerm}" (${scheduleCount})`;
            } else if (selectedDate && selectedRoom) {
                titleText = `${selectedDate} - ${scheduleData[selectedRoom].name}`;
            } else if (selectedDate) {
                titleText = `Escalas de ${selectedDate}`;
            } else if (selectedRoom) {
                titleText = `Sala ${scheduleData[selectedRoom].name}`;
            }
            resultsTitle.textContent = titleText;
        }

        function resetFilters() {
            resetDateAndRoomFilters(); 
            searchTerm = ''; 
            document.getElementById('teacherSearchInput').value = ''; 
            renderSchedules();
        }

        function exportToCSV() {
            let csv = 'Sala,Idade,Data,Li√ß√£o,Professor 1,Professor 2,Professor 3\n';
            
            Object.keys(scheduleData).forEach(roomKey => {
                const room = scheduleData[roomKey];
                room.schedules.forEach(schedule => {
                    const teachers = schedule.teachers.filter(t => t && t.trim() !== '');
                    const t1 = teachers[0] || '';
                    const t2 = teachers[1] || '';
                    const t3 = teachers[2] || '';
                    csv += `${room.name},${room.age},${schedule.date},${schedule.lesson},"${t1}","${t2}","${t3}"\n`; // Adicionado aspas para nomes com v√≠rgulas
                });
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'escalas_ministerio_infantil.csv';
            link.click();
        }

        /* ---------------------------------- */
        /* FUN√á√ïES DA ABA CHAMADA (ATUALIZADAS PARA CART√ïES) */
        /* ---------------------------------- */

        function checkCallFormValidity() {
            const teacherName = document.getElementById('teacherName').value.trim();
            const date = document.getElementById('dateInput').value;
            const submitBtn = document.querySelector('.btn-submit');
            
            // Habilita se sala, nome e data estiverem preenchidos
            const isValid = selectedRoomKeyChamada && teacherName && date;
            
            submitBtn.disabled = !isValid;
        }
        
        function initializeRoomTabsChamada() {
            const container = document.getElementById('roomTabsCall');
            container.innerHTML = '';
            
            Object.keys(roomsData).forEach(roomKey => {
                const room = roomsData[roomKey];
                const tab = document.createElement('div');
                tab.className = 'room-tab-call';
                tab.setAttribute('data-room-key', roomKey); // NOVO: Adiciona chave para sele√ß√£o
                tab.innerHTML = `<div class="room-name-tab">${room.icon} ${room.name}</div><div class="room-age-tab">${room.age}</div>`;
                tab.onclick = () => selectRoomChamada(roomKey, tab);
                container.appendChild(tab);
            });
            
            // Define a data atual no input de data
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // M√™s come√ßa em 0
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('dateInput').value = `${yyyy}-${mm}-${dd}`;
            
            renderEmptyKidsList();
            checkCallFormValidity(); // Desabilita o bot√£o inicialmente
        }
        
        function renderEmptyKidsList() {
            document.getElementById('kidsList').innerHTML = `
                <div class="empty-state">
                    Escolha uma sala para come√ßar a lista de chamada.
                </div>
            `;
            document.getElementById('chamadaTitle').innerHTML = `üìù Chamada - Selecione a Sala Acima üëÜ`;
        }

        function togglePresence(element) {
            element.classList.toggle('present');
        }

        function selectRoomChamada(roomKey, tabElement) {
            document.querySelectorAll('.room-tab-call').forEach(t => t.classList.remove('active'));
            
            if (tabElement) {
                tabElement.classList.add('active');
            }
            selectedRoomKeyChamada = roomKey;
            
            const room = roomsData[roomKey];
            document.getElementById('chamadaTitle').innerHTML = `üìù Chamada - ${room.icon} Sala ${room.name}`;
            renderKidsList(roomKey); // Passa a chave da sala
            
            // Habilita o campo de crian√ßa extra
            document.getElementById('extraKidName').disabled = false;
            document.querySelector('.btn-add-kid').disabled = false;

            checkCallFormValidity();
        }

        let extraKidCounter = 0; // Contador para IDs exclusivos de crian√ßas adicionadas

        function addExtraKid() {
            const extraKidNameInput = document.getElementById('extraKidName');
            const name = extraKidNameInput.value.trim();
            const kidsGrid = document.querySelector('#kidsList .kids-grid');

            if (!name) {
                alert("Por favor, digite o nome da crian√ßa!");
                return;
            }

            if (!kidsGrid) {
                alert("Selecione uma sala primeiro!");
                return;
            }
            
            extraKidCounter++;
            const kidId = `extra-${extraKidCounter}`;
            
            // Cria o novo cart√£o
            const newKidCard = document.createElement('div');
            newKidCard.className = 'kid-card extra present'; // J√° marca como presente (chegou agora)
            newKidCard.setAttribute('onclick', 'togglePresence(this)');
            newKidCard.setAttribute('data-kid-name', `${name} (Extra)`);

            newKidCard.innerHTML = `
                <img class="kid-photo" src="https://via.placeholder.com/150/ffc107/ffffff?text=‚ú®" alt="Crian√ßa Extra">
                <div class="kid-name">${name}</div>
            `;
            
            kidsGrid.appendChild(newKidCard);
            
            // Limpa o input ap√≥s a adi√ß√£o
            extraKidNameInput.value = '';
            extraKidNameInput.focus();
            
            checkCallFormValidity(); // Garante que o bot√£o de submiss√£o est√° validado
        }
        
        function renderKidsList(roomKey) {
            const container = document.getElementById('kidsList');
            const kids = kidsData[roomKey] || [];
            
            if (kids.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Lista de Crian√ßas Vazia</h3>
                        <p>Nenhuma crian√ßa cadastrada para esta sala.</p>
                    </div>
                `;
                return;
            }
            
            let html = `<div class="form-label">üëã Toque na foto da crian√ßa que est√° PRESENTE</div>`;
            html += `<div class="kids-grid">`;
            
            kids.forEach(kid => {
                // A URL da foto deve ser ajustada para o local onde voc√™ salvar√° as imagens.
                // Exemplo: 'img/' + kid.photo ou um URL completo se hospedado
                const photoUrl = kid.photo.startsWith('http') ? kid.photo : `img/${kid.photo}`;
                
                html += `
                    <div class="kid-card" onclick="togglePresence(this)" data-kid-name="${kid.name}">
                        <img class="kid-photo" src="${photoUrl}" alt="${kid.name}" onerror="this.onerror=null; this.src='https://via.placeholder.com/150/667eea/ffffff?text=üë∂';">
                        <div class="kid-name">${kid.name}</div>
                    </div>
                `;
            });

            html += `</div>`;
            container.innerHTML = html;
        }
        
        async function submitCall() {

            if (!selectedRoomKeyChamada) {
                alert("Por favor, selecione uma Sala!");
                return;
            }

            const submitBtn = document.querySelector('.btn-submit');
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Enviando...';

            const teacherName = document.getElementById('teacherName').value.trim();
            const date = document.getElementById('dateInput').value; // Formato YYYY-MM-DD

            if (!teacherName || !date) {
                alert("Por favor, preencha seu nome e a data da aula!");
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Finalizar Chamada';
                checkCallFormValidity();
                return;
            }
            
            const room = roomsData[selectedRoomKeyChamada];
            
            // COLETA OS NOMES DE TODOS OS CARDS MARCADOS COMO 'present'
            const presentKidsElements = document.querySelectorAll('#kidsList .kid-card.present');
            const presentKids = Array.from(presentKidsElements).map(el => el.getAttribute('data-kid-name'));

            const totalPresent = presentKids.length;

            if (totalPresent === 0) {
                alert("Nenhuma crian√ßa registrada! Por favor, toque no cart√£o das crian√ßas presentes.");
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Finalizar Chamada';
                checkCallFormValidity();
                return;
            }
            
            // Usando URLSearchParams para dados de formul√°rio (formato que o Apps Script prefere)
            const formData = new URLSearchParams();
            formData.append('room_name', room.name);
            formData.append('room_age', room.age);
            formData.append('lesson_date', date);
            formData.append('teacher_name', teacherName);
            formData.append('total_present', totalPresent);
            formData.append('kids_list', presentKids.join('; ')); // Junta em uma string separada por ;

            try {
                const response = await fetch(SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    body: formData // Envia os dados no formato de formul√°rio
                });
                
                // Limpar as sele√ß√µes e a lista de crian√ßas extras
                document.querySelectorAll('#kidsList .kid-card').forEach(card => {
                    if (card.classList.contains('extra')) {
                        card.remove(); // Remove crian√ßas extras
                    } else {
                        card.classList.remove('present'); // Limpa sele√ß√£o das crian√ßas fixas
                    }
                });
                document.getElementById('extraKidName').value = '';
                extraKidCounter = 0; // Reinicia o contador

                alert(`üéâ Chamada da Sala ${room.name} conclu√≠da com sucesso! Os ${totalPresent} nomes foram enviados para a planilha.`);

            } catch (error) {
                console.error("Erro ao enviar dados para o Google Sheet:", error);
                alert("‚ùå Erro ao enviar a chamada. Tente novamente ou verifique a conex√£o.");
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Finalizar Chamada';
                checkCallFormValidity(); // Revalida o bot√£o
            }
        }


        // INICIALIZA√á√ÉO GERAL
        initializeDateButtons();
        initializeRoomButtons();
        initializeRoomTabsChamada(); // Inicializa os bot√µes da aba Chamada
        renderSchedules();

        // Adiciona listeners para validar o formul√°rio
        document.getElementById('teacherName').addEventListener('input', checkCallFormValidity);
        document.getElementById('dateInput').addEventListener('input', checkCallFormValidity);
    </script>
</body>
</html>
